<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Feedback Tool - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.bootstrap5.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light shadow bg-light">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">Feedback Tool</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <!-- Dropdown button for account -->
                <div class="dropdown">
                    <button class="btn btn-lg btn-light dropdown-toggle" type="button" id="accountDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
                        <li><a class="dropdown-item" href="#">Profile</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#">Logout</a></li>
                    </ul>
            </div>
        </div>
    </nav>
    <!-- Banner below the navbar -->
    <div class="container-fluid bg-dark bg-gradient py-5 text-white" style="height: 200px;">
        <h1>Welcome students to the Group Feedback Tool</h1>
        <p>Your one-stop solution for gathering and analyzing feedback.</p>
    </div>

    <!-- Main content area -->
    <div class="container-fluid mb-4" id="divCourseCards">
        <h2 class="mt-4 mb-4">My Courses</h2>
        <div class="bg-light p-4 shadow-lg">
            <div class="row row-cols-1 row-cols-md-3 g-4">
    
                <!-- Card 1 -->
                <div class="col">
                    <div class="card h-100 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title">CSC 3100</h5>
                            <p class="card-text">Description of CSC 3100. This course covers topics A, B, and C.</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-primary col-3 btn-view-course-details">View Details</button>
                                <p class="card-text italicize">Review Unavailable</p>
                                <button class="btn btn-primary col-3 text-end btn-start-review d-none">Start Review</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Card 2 -->
                <div class="col">
                    <div class="card h-100 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title">Course 2</h5>
                            <p class="card-text">Description of Course 2. This course focuses on topics X, Y, and Z.</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-primary col-3 btn-view-course-details">View Details</button>
                                <p class="card-text italicize d-none">Review Unavailable</p>
                                <button class="btn btn-primary col-3 text-end btn-start-review">Start Review</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Card 3 -->
                <div class="col">
                    <div class="card h-100 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title">Course 3</h5>
                            <p class="card-text">Description of Course 3. Learn about topics M, N, and O.</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <button class="btn btn-primary col-3 btn-view-course-details">View Details</button>
                                <p class="card-text italicize">Review Unavailable</p>
                                <button class="btn btn-primary col-3 text-end btn-start-review d-none">Start Review</button>
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Dynamically filled cards -->
                
            </div>
        </div>
        


    </div>

    <!-- Course Details View -->
    <div id="courseDetailsView" class="container-fluid d-none">
        <div class="bg-light p-4 shadow-lg">
            <!-- Tabs for Course Details -->
            <ul class="nav nav-tabs" id="courseDetailsTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#tabOverview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="students-tab" data-bs-toggle="tab" data-bs-target="#tabStudents" type="button" role="tab" aria-controls="students" aria-selected="false">Students</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="teams-tab" data-bs-toggle="tab" data-bs-target="#tabTeams" type="button" role="tab" aria-controls="teams" aria-selected="false">Teams</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#tabReviews" type="button" role="tab" aria-controls="reviews" aria-selected="false">Reviews</button>
                </li>
            </ul>
            <div class="tab-content mt-3" id="courseDetailsTabsContent">
                <!-- Overview Tab -->
                <div class="tab-pane fade show active" id="tabOverview" role="tabpanel" aria-labelledby="overview-tab">
                    <h2 id="courseName">Course Name</h2>
                    <p id="courseDescription">Course description goes here.</p>
                    <hr>
                    <!-- Grade Average and Number of students in class -->
                    <h3>Course Reports</h3>
                    <p>Grade Average: <span id="gradeAverage">85%</span></P>
                    <P>Number of Students: <span id="numberOfStudents">30</span></P>
                </div>
                <!-- Students Tab -->
                <div class="tab-pane fade" id="tabStudents" role="tabpanel" aria-labelledby="students-tab">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Students</h2>
                    </div>
                    <table class="table table-striped" id="tblStudents">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Team Name</th>
                                <th>Team #</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTableBody">
                            <!-- Dynamically filled rows -->
                            <tr>
                                <td>1</td>
                                <td>John Doe</td>
                                <td>johndoe@example.com</td>
                                <td>Team Alpha</td>
                                <td>1</td>
                                
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>Jane Smith</td>
                                <td>janesmith@example.com</td>
                                <td>Team Alpha</td>
                                <td>1</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>Emily Johnson</td>
                                <td>emilyjohnson@example.com</td>
                                <td>N/A</td>
                                <td>N/A</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- Teams Tab -->
                <div class="tab-pane fade" id="tabTeams" role="tabpanel" aria-labelledby="teams-tab">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h2>Teams</h2>
                    </div>
                    <table class="table table-striped" id="tblTeams">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Team Name</th>
                                <th>Members</th>
                                <th>Reviews</th>
                            </tr>
                        </thead>
                        <tbody id="teamsTableBody">
                            <!-- Dynamically filled rows -->
                            <tr>
                                <td>1</td>
                                <td>Team Alpha</td>
                                <td>John Doe, Jane Smith</td>
                                <td>
                                    <button class="btn btn-sm btn-primary"><i class="bi bi-eye"></i> View Feedback</button>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Reviews Tab -->
            <div class="tab-pane fade table-container" id="tabReviews" role="tabpanel" aria-labelledby="reviews-tab">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2>Reviews</h2>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped" id="tblReviews">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Sender</th>
                                <th>Team</th>
                                <th>Score</th>
                                <th>Public Feedback</th>
                            </tr>
                        </thead>
                        <tbody id="ReviewsTableBody">
                            <!-- Dynamically filled rows -->
                            <tr>
                                <td>1</td>
                                <td>Jane Smith</td>
                                <td>Team Alpha</td>
                                <td>7</td>
                                <td>Great work! You have a great attitude.</td>
                            </tr>
                        </tbody>
                    </table>

                </div>
            </div>
            <!-- Back Button -->
            <button class="btn btn-secondary mt-3" id="backToDashboard">Back to Course List</button>
        </div>
    </div>

    <!-- Review Details View -->
    <div id="divReviewOptions" class="container-fluid mb-4 d-none">
        <div class="bg-light p-4 shadow-lg">
            <h2>Review Details</h2>
            <div class="row row-cols-1 row-cols-md-3 g-4">
    
                <!-- Card 1 -->
                <div class="col">
                    <div class="card h-100 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title">CSC 3100</h5>
                            <p class="card-text">Review Unavailable</p>
                            <button class="btn btn-primary btn-start-review d-none">Start Review</button>
                        </div>
                    </div>
                </div>
                <!-- Card 2 -->
                <div class="col">
                    <div class="card h-100 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title">Course 2</h5>
                            <p class="card-text">Review Available</p>
                            <button class="btn btn-primary btn-start-review">Start Review</button>
                        </div>
                    </div>
                </div>
                <!-- Card 3 -->
                <div class="col">
                    <div class="card h-100 shadow-lg">
                        <div class="card-body">
                            <h5 class="card-title">Course 3</h5>
                            <p class="card-text">Review Unavailable</p>
                            <button class="btn btn-primary btn-start-review d-none">Start Review</button>
                        </div>
                    </div>
                </div>
    
                <!-- Dynamically filled cards -->
            </div>
        </div>
    </div>

    <!-- Team Member Review Form -->
    <form id="frmTeamMemberReview" class="container-fluid col-10 mt-5 d-none">
        <div class="card-body">
            <h1 class="text-center text-primary fw-bold">Review</h1>
            <h3 id="txtTeamMemberName" class="text-dark">Team Member: </h3>
            <h6 class="mt-4">Please provide a rating for this team member:</h6>
            <div class="form-floating col-2">
                <input id="txtReviewScore" class="form-control shadow review-question" aria-label="Input for Review Score" type="text" placeholder="Review Score">
                <label for="txtReviewScore">Score (1-10)</label>
            </div>
            <h6 class="mt-4">Please provide any public feedback you have for this team member. Keep in mind, they may see this feedback so focus on being constructive with the goal to improve.</h6>
            <div class="form-floating">
                <textarea id="txtPublicFeedback" class="form-control shadow review-question" aria-label="Input for Public Feedback" type="text" placeholder="Public Feedback" style="height: 150px;"></textarea>
            </div>
            <h6 class="mt-4">Please provide any private feedback you have for this team member. This feedback will never be seen by the team member, so please be honest.</h6>
            <div class="form-floating">
                <textarea id="txtPrivateFeedback" class="form-control shadow review-question" aria-label="Input for Private Feedback" type="text" placeholder="Private Feedback" style="height: 150px;"></textarea>
            </div>
            <!-- Place to dynamically create questions -->
            <hr class="mt-4 mb-4"/>
            <small class="mt-4">Please review your answers before submitting, as you cannot return once you have submitted or moved to the next team member.</small>
            <button id="btnNextTeamMember" type="button" class="btn btn-primary bg-gradient col-12 mt-2 rounded-3 d-none">Next Team Member</button>
            <button id="btnSubmitReview" type="button" class="btn btn-primary bg-gradient col-12 mt-2 rounded-3">Submit Review</button>
            <button id="btnBackToReviewsFromReviewForm" type="button" class="btn btn-link col-12 mt-2">Go Back</button>
        </div>
    </form>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.bootstrap5.js"></script>
    <script>

        // Initialize DataTables for Students and Teams tables
        $(document).ready(function() {
            $('#tblStudents').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                lengthChange: true,
                columnDefs: [
                    { width: '5%', targets: 4 },
                    { width: '15%', targets: 4 }
                ]
            });
            $('#tblTeams').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                lengthChange: true,
                columnDefs: [
                    { width: '5%', targets: 3  },
                    { width: '15%', targets: 3 }
                ]
            });
            $('#tblReviews').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                lengthChange: true,
                columnDefs: [
                    { width: '5%', targets: 4 },
                    { width: '15%', targets: 4 }
                ]
            });
        });
        
        // get the course information from the database and dynamically fill the course cards
        const objRes
        // dynamically fill the course cards
        document.querySelectorAll

        // Handle "View Details" button click
        document.querySelectorAll('.btn-view-course-details').forEach(button => {
            button.addEventListener('click', () => {
                const courseCard = button.closest('.card');
                const courseName = courseCard.querySelector('.card-title').textContent;
                const courseDescription = courseCard.querySelector('.card-text').textContent;

                // Populate course details
                document.getElementById('courseName').textContent = courseName;
                document.getElementById('courseDescription').textContent = courseDescription;

                // Hide dashboard and show course details view
                document.getElementById('divCourseCards').classList.add('d-none');
                document.getElementById('courseDetailsView').classList.remove('d-none');
            });
        });

        // Back to Dashboard button
        document.getElementById('backToDashboard').addEventListener('click', () => {
            document.getElementById('courseDetailsView').classList.add('d-none');
            document.getElementById('divCourseCards').classList.remove('d-none');
        });


        // variables for testing review format
        let teamMemberNames = ["John Doe", "Jane Smith"]; // This should be dynamically set based on the course and user's team members
        let currentMemberIndex = 0;

        
        // Handle "Start Review" button click
        document.querySelectorAll('.btn-start-review').forEach(button => {
            button.addEventListener('click', () => {
                const courseCard = button.closest('.card');
                const courseName = courseCard.querySelector('.card-title').textContent;
                const teamMemberName = teamMemberNames[currentMemberIndex];
                // Populate review form
                document.getElementById('txtTeamMemberName').textContent = `Team Member: ${teamMemberName}`;

                // Hide review options and show review form
                document.getElementById('divCourseCards').classList.add('d-none');
                document.getElementById('frmTeamMemberReview').classList.remove('d-none');

                // Reset form fields
                if (teamMemberNames.length > 1) {
                    document.getElementById('btnNextTeamMember').classList.remove('d-none');
                    document.getElementById('btnSubmitReview').classList.add('d-none');
                } else {
                    document.getElementById('btnNextTeamMember').classList.add('d-none');
                    document.getElementById('btnSubmitReview').classList.remove('d-none');
                }
            });
        });

        // Handle "Next Team Member" button click
        document.getElementById('btnNextTeamMember').addEventListener('click', () => {
            const reviewScore = document.getElementById('txtReviewScore').value;
            const publicFeedback = document.getElementById('txtPublicFeedback').value;
            const privateFeedback = document.getElementById('txtPrivateFeedback').value;
            console.log("onto the next!")
            // Validate inputs
            if (!reviewScore || !publicFeedback || !privateFeedback) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please fill in all fields before proceeding to the next team member.',
                    confirmButtonText: 'OK'
                });
                return;
            }

            // build in a way to save the current review to database or file here

            Swal.fire({
                icon: 'success',
                title: 'Review Submitted',
                text: 'Your review has been submitted successfully!'
            });

            currentMemberIndex++;
            if (currentMemberIndex >= teamMemberNames.length - 1) {
                // If no more team members, show submit button and hide next button
                document.getElementById('btnNextTeamMember').classList.add('d-none');
                document.getElementById('btnSubmitReview').classList.remove('d-none');
            }
            const teamMemberName = teamMemberNames[currentMemberIndex];
            document.getElementById('txtTeamMemberName').textContent = `Team Member: ${teamMemberName}`;
            // Reset form fields
            document.querySelectorAll('.review-question').forEach(input => {
                input.value = '';
            });
        });

        // Handle "Submit Review" button click
        document.getElementById('btnSubmitReview').addEventListener('click', () => {
            const reviewScore = document.getElementById('txtReviewScore').value;
            const publicFeedback = document.getElementById('txtPublicFeedback').value;
            const privateFeedback = document.getElementById('txtPrivateFeedback').value;
            // build in a way to save the current review to database or file

            // Validate inputs
            if (!reviewScore || !publicFeedback || !privateFeedback) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please fill in all fields before proceeding to the next team member.',
                    confirmButtonText: 'OK'
                });
                return;
            }

            // Submit review to the server or save it locally

            Swal.fire({
                icon: 'success',
                title: 'Review Submitted',
                text: 'Your review has been submitted successfully!',
                confirmButtonText: 'OK'
            }).then(() => {
                // Reset form and go back to course list
                document.getElementById('frmTeamMemberReview').classList.add('d-none');
                document.getElementById('divCourseCards').classList.remove('d-none');
                document.querySelectorAll('.review-question').forEach(input => {
                    input.value = '';
                });
            });
        });

        // Handle "Back to Reviews" button click
        document.getElementById('btnBackToReviewsFromReviewForm').addEventListener('click', () => {
            document.getElementById('frmTeamMemberReview').classList.add('d-none');
            document.getElementById('divCourseCards').classList.remove('d-none');
            document.querySelectorAll('.review-question').forEach(input => {
                input.value = '';
            });
        });
        
    </script>
</body>
</html>